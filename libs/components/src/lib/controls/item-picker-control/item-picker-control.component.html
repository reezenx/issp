<mat-form-field
  appearance="outline"
  [class]="class"
  color="primary"
  hintLabel="{{ fieldHint }}"
>
  <mat-label class="mat-subtitle-2 f-w-600">{{ fieldName }}</mat-label>
  <mat-icon matPrefix class="op-5">
    <i-tabler [name]="prefixIcon" class="icon-18 d-flex"></i-tabler>
  </mat-icon>
  <ng-container *ngIf="multiple; else single">
    <mat-chip-grid #chipGrid>
      @for(item of items; track item) {
      <mat-chip-row
        (removed)="remove(item)"
        [editable]="true"
        (edited)="edit(item, $event)"
        [aria-description]="'press enter to edit ' + item"
        class="f-s-14"
      >
        {{ item }}
        <button matChipRemove [attr.aria-label]="'remove ' + item">
          <mat-icon>cancel</mat-icon>
        </button>
      </mat-chip-row>
      }

      <input
        #cnt
        [formControl]="inputControl"
        [placeholder]="placeholder"
        [matChipInputFor]="chipGrid"
        [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
        [matChipInputAddOnBlur]="addOnBlur"
        (matChipInputTokenEnd)="add($event)"
      />
    </mat-chip-grid>
  </ng-container>
  <ng-template #single>
    <input
      [attr.data-test]="id"
      type="text"
      matInput
      [formControl]="inputControl"
      [matAutocomplete]="itemAutoComplete"
      [placeholder]="placeholder"
    />
  </ng-template>

  <button
    mat-icon-button
    matSuffix
    type="button"
    class="m-r-4"
    (click)="discardChanges()"
    [attr.aria-label]="'Clear'"
    [disabled]="!inputControl.value"
  >
    <mat-icon matPrefix class="op-5">
      <i-tabler name="backspace" class="icon-18 d-flex"></i-tabler>
    </mat-icon>
  </button>
  @if(inputControl.touched && inputControl.invalid) {
  <mat-hint [align]="'end'" class="m-b-16 error-msg">
    @if(inputControl.errors && inputControl.errors['required']) {
    <div class="text-error">{{ fieldName }} is required.</div>
    }
  </mat-hint>
  }
  <mat-autocomplete
    #itemAutoComplete="matAutocomplete"
    [displayWith]="displayFn"
    (optionSelected)="onOptionSelected($event)"
  >
    @for(option of itemsFilteredOptions$ | async; track option.id) {
    <mat-option [value]="option">
      {{ displayCode ? '(' + option.code + ')' : '' }}
      {{ sentenceCase ? (option.name | sentenceCase) : option.name }}
    </mat-option>
    }
  </mat-autocomplete>
</mat-form-field>
